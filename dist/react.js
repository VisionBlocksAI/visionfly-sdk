var e=require("react");function r(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function t(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(){return n=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},n.apply(null,arguments)}function o(e,r){if(null==e)return{};var t={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==r.indexOf(n))continue;t[n]=e[n]}return t}function i(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var a=/*#__PURE__*/function(){function e(e){var r=e.apiSecret,t=e.baseUrl,n=void 0===t?"https://api.visionfly.ai":t,o=e.cdnUrl,i=void 0===o?"https://cdn.visionfly.ai":o;this.apiKey=e.apiKey,this.apiSecret=r,this.baseUrl=n,this.cdnUrl=i,this.token=null,this.tokenExpiry=null,this.refreshToken=null,this.urlCache=new Map}var r=e.prototype;return r._ensureAuthenticated=function(){try{var e=this;return e.token&&e.tokenExpiry&&e.tokenExpiry>Date.now()?Promise.resolve():Promise.resolve(e._authenticate()).then(function(){})}catch(e){return Promise.reject(e)}},r._authenticate=function(){try{var e=this;return Promise.resolve(i(function(){return Promise.resolve(fetch(e.baseUrl+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:e.apiKey,api_secret:e.apiSecret})})).then(function(r){function t(t){return Promise.resolve(r.json()).then(function(r){e.token=r.access_token,e.refreshToken=r.refresh_token,e.tokenExpiry=Date.now()+1e3*r.expires_in-3e5})}var n=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Authentication failed")})}();return n&&n.then?n.then(t):t()})},function(e){throw console.error("VisionFly authentication error:",e),e}))}catch(e){return Promise.reject(e)}},r._refreshToken=function(){try{var e=this;return Promise.resolve(i(function(){return Promise.resolve(fetch(e.baseUrl+"/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refreshToken})})).then(function(r){function t(t){return Promise.resolve(r.json()).then(function(r){e.token=r.access_token,e.refreshToken=r.refresh_token,e.tokenExpiry=Date.now()+1e3*r.expires_in-3e5})}var n=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Token refresh failed")})}();return n&&n.then?n.then(t):t()})},function(e){throw console.error("VisionFly token refresh error:",e),e}))}catch(e){return Promise.reject(e)}},r._request=function(e,r){void 0===r&&(r={});try{var t=this;return Promise.resolve(t._ensureAuthenticated()).then(function(){var o={headers:{Authorization:"Bearer "+t.token}},a=n({},o,r,{headers:n({},o.headers,r.headers)});return i(function(){return Promise.resolve(fetch(""+t.baseUrl+e,a)).then(function(r){function n(){function e(e){return r.json()}var t=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Request failed with status "+r.status)})}();return t&&t.then?t.then(e):e()}var o=function(){if(401===r.status)return Promise.resolve(t._refreshToken()).then(function(){return a.headers.Authorization="Bearer "+t.token,Promise.resolve(fetch(""+t.baseUrl+e,a)).then(function(e){r=e})})}();return o&&o.then?o.then(n):n()})},function(e){throw console.error("VisionFly request error:",e),e})})}catch(e){return Promise.reject(e)}},r.getImageUrl=function(e){try{var r=this,t=JSON.stringify(e);if(r.urlCache.has(t))return Promise.resolve(r.urlCache.get(t));var n=new URLSearchParams,o={src:"src",width:"w",height:"h",quality:"q",format:"f",blur:"blur",sharpen:"sharp",brightness:"bri",contrast:"con",saturation:"sat",hue:"hue"};Object.entries(e).forEach(function(e){var r=e[0],t=e[1];null!=t&&n.append(o[r]||r,t)});var i="/transform?"+n.toString();return Promise.resolve(r._request(i)).then(function(e){if(!e.public_url)throw new Error("Transform API did not return a public_url");return r.urlCache.set(t,e.public_url),e.public_url})}catch(e){return Promise.reject(e)}},r.getSrcSet=function(e){try{var r=this,n=e.src,o=e.widths,i=void 0===o?[400,800,1200]:o,a=e.format,s=void 0===a?"auto":a,u=e.quality,l=void 0===u?80:u,c=Array.isArray(i)?i.join(","):i,h=new URLSearchParams({src:n,w:c,f:s,q:l});return Promise.resolve(r._request("/generate/srcset?"+h.toString())).then(function(e){var n=e.srcset.split(",").map(function(e){return e.trim()});return Promise.resolve(Promise.all(n.map(function(e){try{for(var n,o=e.split(" "),i=o[1],a=new URL(o[0]),s={},u={src:"src",w:"width",h:"height",q:"quality",f:"format",blur:"blur",sharp:"sharpen",bri:"brightness",con:"contrast",sat:"saturation",hue:"hue"},l=t(a.searchParams.entries());!(n=l()).done;){var c=n.value,h=c[0];s[u[h]||h]=c[1]}return Promise.resolve(r.getImageUrl(s)).then(function(e){return e+" "+i})}catch(e){return Promise.reject(e)}}))).then(function(n){for(var o,i={},a={src:"src",w:"width",h:"height",q:"quality",f:"format",blur:"blur",sharp:"sharpen",bri:"brightness",con:"contrast",sat:"saturation",hue:"hue"},s=t(new URL(e.default).searchParams.entries());!(o=s()).done;){var u=o.value,l=u[0];i[a[l]||l]=u[1]}return Promise.resolve(r.getImageUrl(i)).then(function(r){return{srcset:n.join(", "),sizes:e.sizes,default:r}})})})}catch(e){return Promise.reject(e)}},r.uploadImage=function(e){try{var r=e.file,t=e.projectId,n=e.publicId,o=new FormData;return o.append("file",r),o.append("project_id",t),n&&o.append("public_id",n),Promise.resolve(this._request("/upload/",{method:"POST",body:o,headers:{}}))}catch(e){return Promise.reject(e)}},r.clearCache=function(){this.urlCache.clear()},e}(),s=["src","width","height","quality","format","blur","sharpen","brightness","contrast","saturation","hue","alt","className","style","loading"],u=["src","widths","sizes","quality","format","alt","className","style","loading"],l=["projectId","onUpload","onError","publicId","multiple","className","style","buttonClassName","buttonStyle","buttonText","children"];function c(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var f=e.createContext(null);function d(r){var t=r.config,n=r.children,o=e.useState(function(){return new a(t)})[0],i=e.useState(!1),s=i[0],u=i[1];return e.useEffect(function(){!function(){try{var e=c(function(){return Promise.resolve(o._ensureAuthenticated()).then(function(){u(!0)})},function(e){console.error("Failed to initialize VisionFly client:",e)});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[o]),h(f.Provider,{value:{client:o,ready:s}},n)}function v(){var r=e.useContext(f);if(!r)throw new Error("useVisionFly must be used within a VisionFlyProvider");return r}function m(r){var t=r.src,i=r.width,a=r.height,u=r.quality,l=r.format,f=r.blur,d=r.sharpen,m=r.brightness,p=r.contrast,y=r.saturation,g=r.hue,b=r.alt,P=void 0===b?"":b,w=r.className,j=void 0===w?"":w,S=r.style,k=void 0===S?{}:S,I=r.loading,x=void 0===I?"lazy":I,_=o(r,s),U=v(),q=U.client,C=U.ready,F=e.useState(""),N=F[0],E=F[1],A=e.useState(!0),T=A[0],V=A[1],O=e.useState(null),z=O[0],R=O[1];return e.useEffect(function(){if(C&&t){var e=!0;return V(!0),function(){try{var r=c(function(){return Promise.resolve(q.getImageUrl({src:t,width:i,height:a,quality:u,format:l,blur:f,sharpen:d,brightness:m,contrast:p,saturation:y,hue:g})).then(function(r){e&&(E(r),V(!1))})},function(r){e&&(console.error("Failed to load image:",r),R(r),V(!1))});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!1}}},[q,C,t,i,a,u,l,f,d,m,p,y,g]),T?h("div",n({className:"vf-image-placeholder "+j,style:n({width:i?i+"px":"100%",height:a?a+"px":"auto",backgroundColor:"#f0f0f0"},k)},_)):z?h("div",n({className:"vf-image-error "+j,style:n({width:i?i+"px":"100%",height:a?a+"px":"auto",backgroundColor:"#ff5555",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},k)},_),"Error loading image"):h("img",n({src:N,alt:P,width:i,height:a,loading:x,className:"vf-image "+j,style:k},_))}function p(r){var t=r.src,i=r.widths,a=r.sizes,s=r.quality,l=r.format,f=r.alt,d=void 0===f?"":f,m=r.className,p=void 0===m?"":m,y=r.style,g=void 0===y?{}:y,b=r.loading,P=void 0===b?"lazy":b,w=o(r,u),j=v(),S=j.client,k=j.ready,I=e.useState(null),x=I[0],_=I[1],U=e.useState(!0),q=U[0],C=U[1],F=e.useState(null),N=F[0],E=F[1];return e.useEffect(function(){if(k&&t){var e=!0;return C(!0),function(){try{var r=c(function(){return Promise.resolve(S.getSrcSet({src:t,widths:i,format:l,quality:s})).then(function(r){e&&(_(r),C(!1))})},function(r){e&&(console.error("Failed to load srcset:",r),E(r),C(!1))});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!1}}},[S,k,t,i&&JSON.stringify(i),a,s,l]),q?h("div",n({className:"vf-image-placeholder "+p,style:n({width:"100%",height:"300px",backgroundColor:"#f0f0f0"},g)},w)):N?h("div",n({className:"vf-image-error "+p,style:n({width:"100%",height:"300px",backgroundColor:"#ff5555",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},g)},w),"Error loading image"):h("img",n({src:x.default,srcSet:x.srcset,sizes:a||x.sizes,alt:d,loading:P,className:"vf-responsive-image "+p,style:g},w))}function y(r){var t=r.projectId,i=r.onUpload,a=r.onError,s=r.publicId,u=r.multiple,f=void 0!==u&&u,d=r.className,m=void 0===d?"":d,p=r.style,y=void 0===p?{}:p,g=r.buttonClassName,b=void 0===g?"":g,P=r.buttonStyle,w=void 0===P?{}:P,j=r.buttonText,S=void 0===j?"Upload Image":j,k=r.children,I=o(r,l),x=v(),_=x.client,U=x.ready,q=e.useState(!1),C=q[0],F=q[1],N=e.useRef(null),E=e.useCallback(function(e){try{var r=e.target.files;if(!r||0===r.length)return Promise.resolve();F(!0);var n=c(function(){function e(){N.current&&(N.current.value="")}var n=f?Promise.resolve(Promise.all(Array.from(r).map(function(e){return _.uploadImage({file:e,projectId:t,publicId:s||void 0})}))).then(function(e){F(!1),i&&i(e)}):Promise.resolve(_.uploadImage({file:r[0],projectId:t,publicId:s||void 0})).then(function(e){F(!1),i&&i(e)});return n&&n.then?n.then(e):e()},function(e){F(!1),console.error("Upload failed:",e),a&&a(e)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[_,t,s,f,i,a]),A=k||h("button",{type:"button",className:"vf-upload-button "+b,style:w,disabled:C||!U},C?"Uploading...":S);return h("div",n({className:"vf-uploader "+m,style:y},I),h("input",{ref:N,type:"file",accept:"image/*",multiple:f,onChange:E,style:{display:"none"},id:"vf-file-input"}),h("label",{htmlFor:"vf-file-input"},A))}var g={VisionFlyProvider:d,useVisionFly:v,VFImage:m,VFResponsiveImage:p,VFUploader:y};exports.VFImage=m,exports.VFResponsiveImage=p,exports.VFUploader=y,exports.VisionFlyProvider=d,exports.default=g,exports.useVisionFly=v;
//# sourceMappingURL=react.js.map
