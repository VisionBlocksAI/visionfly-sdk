import{createContext as r,useContext as t,useState as e,useEffect as n}from"react";import i from"next/image";function o(){return o=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)({}).hasOwnProperty.call(e,n)&&(r[n]=e[n])}return r},o.apply(null,arguments)}function a(r,t){if(null==r)return{};var e={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(-1!==t.indexOf(n))continue;e[n]=r[n]}return e}var u=r(null);function s(){var r=t(u);if(!r)throw new Error("useVisionFly must be used within a VisionFlyProvider");return r}var l=["src","width","height","quality","format","blur","sharpen","brightness","contrast","saturation","hue","alt","placeholder"],c=["src","widths","sizes","quality","format","fill","alt","placeholder"];function f(r,t){try{var e=r()}catch(r){return t(r)}return e&&e.then?e.then(void 0,t):e}function d(r){var t=r.src,u=r.width,c=r.height,d=r.quality,v=r.format,m=r.blur,g=r.sharpen,b=r.brightness,p=r.contrast,w=r.saturation,y=r.hue,P=r.alt,q=void 0===P?"":P,U=r.placeholder,S=void 0===U?"blur":U,O=a(r,l),L=s(),j=L.client,x=L.ready,F=e(""),R=F[0],z=F[1],B=e(""),I=B[0],k=B[1],C=e(!0),D=C[0],E=C[1];return n(function(){x&&t&&function(){try{var r=f(function(){return Promise.resolve(j.getImageUrl({src:t,width:u,height:c,quality:d,format:v,blur:m,sharpen:g,brightness:b,contrast:p,saturation:w,hue:y})).then(function(r){function e(){E(!1)}z(r);var n=function(){if("blur"===S)return Promise.resolve(j.getImageUrl({src:t,width:20,quality:20,format:"webp",blur:10})).then(function(r){return Promise.resolve(fetch(r)).then(function(r){return Promise.resolve(r.arrayBuffer()).then(function(r){var t=Buffer.from(r).toString("base64");k("data:image/webp;base64,"+t)})})})}();return n&&n.then?n.then(e):e()})},function(r){console.error("Failed to load image:",r),E(!1)});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(r){return Promise.reject(r)}}()},[j,x,t,u,c,d,v,m,g,b,p,w,y,S]),D||!R?h("div",{style:{width:u||"100%",height:c||"300px",backgroundColor:"#f0f0f0"}}):h(i,o({src:R,alt:q,width:u,height:c,blurDataURL:I,placeholder:S},O))}function v(r){var t=r.src,u=r.widths,l=r.sizes,d=r.quality,v=r.format,m=r.fill,g=void 0===m||m,b=r.alt,p=void 0===b?"":b,w=r.placeholder,y=void 0===w?"blur":w,P=a(r,c),q=s(),U=q.client,S=q.ready,O=e(null),L=O[0],j=O[1],x=e(""),F=x[0],R=x[1],z=e(!0),B=z[0],I=z[1];return n(function(){S&&t&&function(){try{var r=f(function(){return Promise.resolve(U.getSrcSet({src:t,widths:u,format:v,quality:d})).then(function(r){function e(){I(!1)}j(r);var n=function(){if("blur"===y)return Promise.resolve(U.getImageUrl({src:t,width:20,quality:20,format:"webp",blur:10})).then(function(r){return Promise.resolve(fetch(r)).then(function(r){return Promise.resolve(r.arrayBuffer()).then(function(r){var t=Buffer.from(r).toString("base64");R("data:image/webp;base64,"+t)})})})}();return n&&n.then?n.then(e):e()})},function(r){console.error("Failed to load srcset:",r),I(!1)});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(r){return Promise.reject(r)}}()},[U,S,t,u&&JSON.stringify(u),d,v,y]),B||!L?h("div",{style:{position:g?"relative":"static",width:"100%",height:g?"100%":"300px",backgroundColor:"#f0f0f0"}}):h(i,o({src:L.default,alt:p,blurDataURL:F,placeholder:y,fill:g,sizes:l||L.sizes,loader:function(r){var t=r.width,e=new URL(r.src),n=Object.fromEntries(e.searchParams.entries());t&&(n.w=t);var i=new URLSearchParams(n);return""+e.origin+e.pathname+"?"+i.toString()}},P))}function m(r,t){return void 0===t&&(t={}),{imageLoader:function(e){var n=e.src,i=e.width,o=e.quality;return n.includes(r.baseUrl||"api.visionfly.ai")?n:(r.baseUrl||"https://api.visionfly.ai")+"/transform?"+new URLSearchParams({src:n,w:i||"",q:o||80,f:t.defaultFormat||"auto"}).toString()}}}export{d as VFNextImage,v as VFNextResponsiveImage,m as setupVisionFly};
//# sourceMappingURL=next.modern.js.map
