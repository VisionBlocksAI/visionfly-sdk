{"version":3,"file":"react.modern.mjs","sources":["../src/visionfly-core.js","../src/visionfly-react.js"],"sourcesContent":["/**\n * VisionFly - Lightweight Image Optimization SDK\n * @version 1.0.0\n */\n\n/**\n * Core VisionFly client\n */\nclass VisionFly {\n  /**\n   * Initialize VisionFly SDK\n   * @param {Object} config - Configuration options\n   * @param {string} config.apiKey - Your VisionFly API key\n   * @param {string} config.apiSecret - Your VisionFly API secret\n   * @param {string} [config.baseUrl='https://api.visionfly.ai'] - Base API URL\n   * @param {string} [config.cdnUrl='https://cdn.visionfly.ai'] - CDN URL\n   */\n  constructor({\n    apiKey,\n    apiSecret,\n    baseUrl = \"https://api.visionfly.ai\",\n    cdnUrl = \"https://cdn.visionfly.ai\",\n  }) {\n    this.apiKey = apiKey;\n    this.apiSecret = apiSecret;\n    this.baseUrl = baseUrl;\n    this.cdnUrl = cdnUrl;\n    this.token = null;\n    this.tokenExpiry = null;\n    this.refreshToken = null;\n\n    // Cache for transformed URLs\n    this.urlCache = new Map();\n  }\n\n  /**\n   * Internal method to handle authentication\n   * @private\n   */\n  async _ensureAuthenticated() {\n    // If token exists and is valid, return\n    if (this.token && this.tokenExpiry && this.tokenExpiry > Date.now()) {\n      return;\n    }\n\n    // If token expired or not set, authenticate\n    await this._authenticate();\n  }\n\n  /**\n   * Authenticate with the API\n   * @private\n   */\n  async _authenticate() {\n    try {\n      const response = await fetch(`${this.baseUrl}/auth/login`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          api_key: this.apiKey,\n          api_secret: this.apiSecret,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.msg || \"Authentication failed\");\n      }\n\n      const data = await response.json();\n      this.token = data.access_token;\n      this.refreshToken = data.refresh_token;\n      // Set expiry 5 minutes before actual expiry as a buffer\n      this.tokenExpiry = Date.now() + data.expires_in * 1000 - 5 * 60 * 1000;\n    } catch (error) {\n      console.error(\"VisionFly authentication error:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Refresh the auth token\n   * @private\n   */\n  async _refreshToken() {\n    try {\n      const response = await fetch(`${this.baseUrl}/auth/refresh`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          refresh_token: this.refreshToken,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.msg || \"Token refresh failed\");\n      }\n\n      const data = await response.json();\n      this.token = data.access_token;\n      this.refreshToken = data.refresh_token;\n      this.tokenExpiry = Date.now() + data.expires_in * 1000 - 5 * 60 * 1000;\n    } catch (error) {\n      console.error(\"VisionFly token refresh error:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Make an authenticated request to the API\n   * @private\n   * @param {string} endpoint - API endpoint\n   * @param {Object} options - Fetch options\n   * @returns {Promise<Object>} Response data\n   */\n  async _request(endpoint, options = {}) {\n    await this._ensureAuthenticated();\n\n    const defaultOptions = {\n      headers: {\n        Authorization: `Bearer ${this.token}`,\n      },\n    };\n\n    const fullOptions = {\n      ...defaultOptions,\n      ...options,\n      headers: {\n        ...defaultOptions.headers,\n        ...options.headers,\n      },\n    };\n\n    try {\n      let response = await fetch(`${this.baseUrl}${endpoint}`, fullOptions);\n\n      // Handle token expiration\n      if (response.status === 401) {\n        await this._refreshToken();\n        fullOptions.headers.Authorization = `Bearer ${this.token}`;\n        response = await fetch(`${this.baseUrl}${endpoint}`, fullOptions);\n      }\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(\n          error.msg || `Request failed with status ${response.status}`\n        );\n      }\n\n      return response.json();\n    } catch (error) {\n      console.error(\"VisionFly request error:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Get a CDN URL for an image with transformations\n   * @param {Object} params - Transformation parameters\n   * @param {string} params.src - Source image URL\n   * @param {number} [params.width] - Width in pixels\n   * @param {number} [params.height] - Height in pixels\n   * @param {number} [params.quality=80] - Image quality (1-100)\n   * @param {string} [params.format='auto'] - Output format (auto, webp, avif, jpeg, png)\n   * @param {number} [params.blur] - Blur amount (0-100)\n   * @param {number} [params.sharpen] - Sharpen amount (0-100)\n   * @param {number} [params.brightness] - Brightness adjustment (-100 to 100)\n   * @param {number} [params.contrast] - Contrast adjustment (-100 to 100)\n   * @param {number} [params.saturation] - Saturation adjustment (-100 to 100)\n   * @param {number} [params.hue] - Hue rotation (0-360)\n   * @returns {Promise<string>} CDN URL\n   */\n  async getImageUrl(params) {\n    // Generate a cache key from the params\n    const cacheKey = JSON.stringify(params);\n\n    // Check cache first\n    if (this.urlCache.has(cacheKey)) {\n      return this.urlCache.get(cacheKey);\n    }\n\n    // Build query for the API\n    const apiParams = new URLSearchParams();\n\n    // Map user-friendly param names to API param names\n    const paramMap = {\n      src: \"src\",\n      width: \"w\",\n      height: \"h\",\n      quality: \"q\",\n      format: \"f\",\n      blur: \"blur\",\n      sharpen: \"sharp\",\n      brightness: \"bri\",\n      contrast: \"con\",\n      saturation: \"sat\",\n      hue: \"hue\",\n    };\n\n    // Add all params to query\n    Object.entries(params).forEach(([key, value]) => {\n      if (value !== undefined && value !== null) {\n        const apiKey = paramMap[key] || key;\n        apiParams.append(apiKey, value);\n      }\n    });\n\n    // Get the transformed URL from the API\n    const endpoint = `/transform?${apiParams.toString()}`;\n    const result = await this._request(endpoint);\n\n    if (!result.public_url) {\n      throw new Error(\"Transform API did not return a public_url\");\n    }\n\n    // Cache the result\n    this.urlCache.set(cacheKey, result.public_url);\n\n    return result.public_url;\n  }\n\n  /**\n   * Generate a responsive srcset for an image\n   * @param {Object} params - Srcset parameters\n   * @param {string} params.src - Source image URL\n   * @param {Array<number>|string} [params.widths=[400,800,1200]] - Array or comma-separated string of widths\n   * @param {string} [params.format='auto'] - Output format\n   * @param {number} [params.quality=80] - Image quality\n   * @returns {Promise<Object>} Srcset data with processed URLs\n   */\n  async getSrcSet(params) {\n    const {\n      src,\n      widths = [400, 800, 1200],\n      format = \"auto\",\n      quality = 80,\n    } = params;\n\n    // Convert widths array to string if needed\n    const widthsStr = Array.isArray(widths) ? widths.join(\",\") : widths;\n\n    // Get srcset data from API\n    const apiParams = new URLSearchParams({\n      src,\n      w: widthsStr,\n      f: format,\n      q: quality,\n    });\n\n    const srcsetData = await this._request(\n      `/generate/srcset?${apiParams.toString()}`\n    );\n\n    // Process each URL in the srcset to get actual CDN URLs\n    const srcsetParts = srcsetData.srcset.split(\",\").map((part) => part.trim());\n    const processedParts = await Promise.all(\n      srcsetParts.map(async (part) => {\n        // Split part into URL and width descriptor\n        const [url, widthDesc] = part.split(\" \");\n\n        // Parse URL to get transform parameters\n        const urlObj = new URL(url);\n        const transformParams = {};\n\n        // Convert API params back to SDK format\n        const reverseParamMap = {\n          src: \"src\",\n          w: \"width\",\n          h: \"height\",\n          q: \"quality\",\n          f: \"format\",\n          blur: \"blur\",\n          sharp: \"sharpen\",\n          bri: \"brightness\",\n          con: \"contrast\",\n          sat: \"saturation\",\n          hue: \"hue\",\n        };\n\n        // Extract params from URL\n        for (const [key, value] of urlObj.searchParams.entries()) {\n          const paramKey = reverseParamMap[key] || key;\n          transformParams[paramKey] = value;\n        }\n\n        // Get CDN URL for this width\n        const cdnUrl = await this.getImageUrl(transformParams);\n\n        // Return new srcset entry with CDN URL\n        return `${cdnUrl} ${widthDesc}`;\n      })\n    );\n\n    // Process default URL\n    const defaultUrlObj = new URL(srcsetData.default);\n    const defaultParams = {};\n\n    // Convert API params back to SDK format for default URL\n    const reverseParamMap = {\n      src: \"src\",\n      w: \"width\",\n      h: \"height\",\n      q: \"quality\",\n      f: \"format\",\n      blur: \"blur\",\n      sharp: \"sharpen\",\n      bri: \"brightness\",\n      con: \"contrast\",\n      sat: \"saturation\",\n      hue: \"hue\",\n    };\n\n    // Extract params from default URL\n    for (const [key, value] of defaultUrlObj.searchParams.entries()) {\n      const paramKey = reverseParamMap[key] || key;\n      defaultParams[paramKey] = value;\n    }\n\n    // Get CDN URL for default\n    const defaultCdnUrl = await this.getImageUrl(defaultParams);\n\n    // Return processed srcset data\n    return {\n      srcset: processedParts.join(\", \"),\n      sizes: srcsetData.sizes,\n      default: defaultCdnUrl,\n    };\n  }\n\n  /**\n   * Upload an image to VisionFly\n   * @param {Object} params - Upload parameters\n   * @param {File|Blob} params.file - Image file to upload\n   * @param {string} params.projectId - Project ID\n   * @param {string} [params.publicId] - Optional custom public ID\n   * @returns {Promise<Object>} Upload result\n   */\n  async uploadImage(params) {\n    const { file, projectId, publicId } = params;\n\n    // Create form data\n    const formData = new FormData();\n    formData.append(\"file\", file);\n    formData.append(\"project_id\", projectId);\n\n    if (publicId) {\n      formData.append(\"public_id\", publicId);\n    }\n\n    // Upload the image\n    return this._request(\"/upload/\", {\n      method: \"POST\",\n      body: formData,\n      // Don't set Content-Type header for FormData\n      headers: {},\n    });\n  }\n\n  /**\n   * Clear URL cache\n   */\n  clearCache() {\n    this.urlCache.clear();\n  }\n}\n\nexport default VisionFly;\n","import React, {\n  createContext,\n  useContext,\n  useState,\n  useEffect,\n  useRef,\n  useCallback,\n} from \"react\";\nimport VisionFly from \"./visionfly-core\";\n\n// Create VisionFly context\nconst VisionFlyContext = createContext(null);\n\n/**\n * VisionFly Provider component\n * @param {Object} props - Component props\n * @param {Object} props.config - VisionFly configuration\n * @param {React.ReactNode} props.children - Child components\n */\nexport function VisionFlyProvider({ config, children }) {\n  const [client] = useState(() => new VisionFly(config));\n  const [ready, setReady] = useState(false);\n\n  // Initialize the client\n  useEffect(() => {\n    const init = async () => {\n      try {\n        // Trigger authentication\n        await client._ensureAuthenticated();\n        setReady(true);\n      } catch (error) {\n        console.error(\"Failed to initialize VisionFly client:\", error);\n      }\n    };\n\n    init();\n  }, [client]);\n\n  // Context value\n  const contextValue = {\n    client,\n    ready,\n  };\n\n  return (\n    <VisionFlyContext.Provider value={contextValue}>\n      {children}\n    </VisionFlyContext.Provider>\n  );\n}\n\n/**\n * Hook to access VisionFly client\n * @returns {Object} VisionFly context\n */\nexport function useVisionFly() {\n  const context = useContext(VisionFlyContext);\n\n  if (!context) {\n    throw new Error(\"useVisionFly must be used within a VisionFlyProvider\");\n  }\n\n  return context;\n}\n\n/**\n * Image component with optimization\n * @param {Object} props - Component props\n */\nexport function VFImage({\n  src,\n  width,\n  height,\n  quality,\n  format,\n  blur,\n  sharpen,\n  brightness,\n  contrast,\n  saturation,\n  hue,\n  alt = \"\",\n  className = \"\",\n  style = {},\n  loading = \"lazy\",\n  ...restProps\n}) {\n  const { client, ready } = useVisionFly();\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Get optimized image URL\n  useEffect(() => {\n    if (!ready || !src) return;\n\n    let isMounted = true;\n    setIsLoading(true);\n\n    const loadImage = async () => {\n      try {\n        const url = await client.getImageUrl({\n          src,\n          width,\n          height,\n          quality,\n          format,\n          blur,\n          sharpen,\n          brightness,\n          contrast,\n          saturation,\n          hue,\n        });\n\n        if (isMounted) {\n          setImageUrl(url);\n          setIsLoading(false);\n        }\n      } catch (err) {\n        if (isMounted) {\n          console.error(\"Failed to load image:\", err);\n          setError(err);\n          setIsLoading(false);\n        }\n      }\n    };\n\n    loadImage();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [\n    client,\n    ready,\n    src,\n    width,\n    height,\n    quality,\n    format,\n    blur,\n    sharpen,\n    brightness,\n    contrast,\n    saturation,\n    hue,\n  ]);\n\n  // Placeholder while loading\n  if (isLoading) {\n    return (\n      <div\n        className={`vf-image-placeholder ${className}`}\n        style={{\n          width: width ? `${width}px` : \"100%\",\n          height: height ? `${height}px` : \"auto\",\n          backgroundColor: \"#f0f0f0\",\n          ...style,\n        }}\n        {...restProps}\n      />\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div\n        className={`vf-image-error ${className}`}\n        style={{\n          width: width ? `${width}px` : \"100%\",\n          height: height ? `${height}px` : \"auto\",\n          backgroundColor: \"#ff5555\",\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          color: \"white\",\n          ...style,\n        }}\n        {...restProps}\n      >\n        Error loading image\n      </div>\n    );\n  }\n\n  // Render optimized image\n  return (\n    <img\n      src={imageUrl}\n      alt={alt}\n      width={width}\n      height={height}\n      loading={loading}\n      className={`vf-image ${className}`}\n      style={style}\n      {...restProps}\n    />\n  );\n}\n\n/**\n * Responsive image component with srcset\n * @param {Object} props - Component props\n */\nexport function VFResponsiveImage({\n  src,\n  widths,\n  sizes,\n  quality,\n  format,\n  alt = \"\",\n  className = \"\",\n  style = {},\n  loading = \"lazy\",\n  ...restProps\n}) {\n  const { client, ready } = useVisionFly();\n  const [srcsetData, setSrcsetData] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  // Get srcset data\n  useEffect(() => {\n    if (!ready || !src) return;\n\n    let isMounted = true;\n    setIsLoading(true);\n\n    const loadSrcset = async () => {\n      try {\n        const data = await client.getSrcSet({\n          src,\n          widths,\n          format,\n          quality,\n        });\n\n        if (isMounted) {\n          setSrcsetData(data);\n          setIsLoading(false);\n        }\n      } catch (err) {\n        if (isMounted) {\n          console.error(\"Failed to load srcset:\", err);\n          setError(err);\n          setIsLoading(false);\n        }\n      }\n    };\n\n    loadSrcset();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [\n    client,\n    ready,\n    src,\n    widths && JSON.stringify(widths),\n    sizes,\n    quality,\n    format,\n  ]);\n\n  // Placeholder while loading\n  if (isLoading) {\n    return (\n      <div\n        className={`vf-image-placeholder ${className}`}\n        style={{\n          width: \"100%\",\n          height: \"300px\",\n          backgroundColor: \"#f0f0f0\",\n          ...style,\n        }}\n        {...restProps}\n      />\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div\n        className={`vf-image-error ${className}`}\n        style={{\n          width: \"100%\",\n          height: \"300px\",\n          backgroundColor: \"#ff5555\",\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          color: \"white\",\n          ...style,\n        }}\n        {...restProps}\n      >\n        Error loading image\n      </div>\n    );\n  }\n\n  // Render responsive image\n  return (\n    <img\n      src={srcsetData.default}\n      srcSet={srcsetData.srcset}\n      sizes={sizes || srcsetData.sizes}\n      alt={alt}\n      loading={loading}\n      className={`vf-responsive-image ${className}`}\n      style={style}\n      {...restProps}\n    />\n  );\n}\n\n/**\n * Image uploader component\n * @param {Object} props - Component props\n */\nexport function VFUploader({\n  projectId,\n  onUpload,\n  onError,\n  publicId,\n  multiple = false,\n  className = \"\",\n  style = {},\n  buttonClassName = \"\",\n  buttonStyle = {},\n  buttonText = \"Upload Image\",\n  children,\n  ...restProps\n}) {\n  const { client, ready } = useVisionFly();\n  const [isUploading, setIsUploading] = useState(false);\n  const fileInputRef = useRef(null);\n\n  // Handle file selection\n  const handleFileChange = useCallback(\n    async (event) => {\n      const files = event.target.files;\n      if (!files || files.length === 0) return;\n\n      setIsUploading(true);\n\n      try {\n        // Handle multiple files\n        if (multiple) {\n          const results = await Promise.all(\n            Array.from(files).map((file) =>\n              client.uploadImage({\n                file,\n                projectId,\n                publicId: publicId || undefined,\n              })\n            )\n          );\n\n          setIsUploading(false);\n          if (onUpload) onUpload(results);\n        }\n        // Handle single file\n        else {\n          const result = await client.uploadImage({\n            file: files[0],\n            projectId,\n            publicId: publicId || undefined,\n          });\n\n          setIsUploading(false);\n          if (onUpload) onUpload(result);\n        }\n\n        // Clear the file input\n        if (fileInputRef.current) {\n          fileInputRef.current.value = \"\";\n        }\n      } catch (err) {\n        setIsUploading(false);\n        console.error(\"Upload failed:\", err);\n        if (onError) onError(err);\n      }\n    },\n    [client, projectId, publicId, multiple, onUpload, onError]\n  );\n\n  // Custom button or default\n  const uploadButton = children || (\n    <button\n      type=\"button\"\n      className={`vf-upload-button ${buttonClassName}`}\n      style={buttonStyle}\n      disabled={isUploading || !ready}\n    >\n      {isUploading ? \"Uploading...\" : buttonText}\n    </button>\n  );\n\n  return (\n    <div className={`vf-uploader ${className}`} style={style} {...restProps}>\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple={multiple}\n        onChange={handleFileChange}\n        style={{ display: \"none\" }}\n        id=\"vf-file-input\"\n      />\n      <label htmlFor=\"vf-file-input\">{uploadButton}</label>\n    </div>\n  );\n}\n\n// Export everything\nexport default {\n  VisionFlyProvider,\n  useVisionFly,\n  VFImage,\n  VFResponsiveImage,\n  VFUploader,\n};\n"],"names":["VisionFly","constructor","apiKey","apiSecret","baseUrl","cdnUrl","this","token","tokenExpiry","refreshToken","urlCache","Map","_ensureAuthenticated","Date","now","_authenticate","response","fetch","method","headers","body","JSON","stringify","api_key","api_secret","ok","error","json","Error","msg","data","access_token","refresh_token","expires_in","console","_refreshToken","_request","endpoint","options","defaultOptions","Authorization","fullOptions","_extends","status","getImageUrl","params","cacheKey","has","get","apiParams","URLSearchParams","paramMap","src","width","height","quality","format","blur","sharpen","brightness","contrast","saturation","hue","Object","entries","forEach","key","value","append","toString","result","public_url","set","getSrcSet","_this","widths","widthsStr","Array","isArray","join","w","f","q","srcsetData","srcsetParts","srcset","split","map","part","trim","processedParts","Promise","all","async","url","widthDesc","urlObj","URL","transformParams","reverseParamMap","h","sharp","bri","con","sat","searchParams","defaultUrlObj","default","defaultParams","defaultCdnUrl","sizes","uploadImage","file","projectId","publicId","formData","FormData","clearCache","clear","_excluded","_excluded2","_excluded3","VisionFlyContext","createContext","VisionFlyProvider","config","children","client","useState","ready","setReady","useEffect","init","Provider","useVisionFly","context","useContext","VFImage","_ref","alt","className","style","loading","restProps","_objectWithoutPropertiesLoose","imageUrl","setImageUrl","isLoading","setIsLoading","setError","isMounted","err","loadImage","backgroundColor","display","alignItems","justifyContent","color","VFResponsiveImage","_ref2","setSrcsetData","loadSrcset","srcSet","VFUploader","_ref3","onUpload","onError","multiple","buttonClassName","buttonStyle","buttonText","isUploading","setIsUploading","fileInputRef","useRef","handleFileChange","useCallback","files","event","target","length","results","from","undefined","current","uploadButton","type","disabled","ref","accept","onChange","id","htmlFor","visionflyReact"],"mappings":"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"}