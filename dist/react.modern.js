import{createContext as e,useState as r,useEffect as t,useContext as n,useRef as o,useCallback as i}from"react";function a(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function s(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return a(e,r);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(){return u=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},u.apply(null,arguments)}function l(e,r){if(null==e)return{};var t={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==r.indexOf(n))continue;t[n]=e[n]}return t}function c(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var f=/*#__PURE__*/function(){function e(e){var r=e.apiSecret,t=e.baseUrl,n=void 0===t?"https://api.visionfly.ai":t,o=e.cdnUrl,i=void 0===o?"https://cdn.visionfly.ai":o;this.apiKey=e.apiKey,this.apiSecret=r,this.baseUrl=n,this.cdnUrl=i,this.token=null,this.tokenExpiry=null,this.refreshToken=null,this.urlCache=new Map}var r=e.prototype;return r._ensureAuthenticated=function(){try{var e=this;return e.token&&e.tokenExpiry&&e.tokenExpiry>Date.now()?Promise.resolve():Promise.resolve(e._authenticate()).then(function(){})}catch(e){return Promise.reject(e)}},r._authenticate=function(){try{var e=this;return Promise.resolve(c(function(){return Promise.resolve(fetch(e.baseUrl+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:e.apiKey,api_secret:e.apiSecret})})).then(function(r){function t(t){return Promise.resolve(r.json()).then(function(r){e.token=r.access_token,e.refreshToken=r.refresh_token,e.tokenExpiry=Date.now()+1e3*r.expires_in-3e5})}var n=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Authentication failed")})}();return n&&n.then?n.then(t):t()})},function(e){throw console.error("VisionFly authentication error:",e),e}))}catch(e){return Promise.reject(e)}},r._refreshToken=function(){try{var e=this;return Promise.resolve(c(function(){return Promise.resolve(fetch(e.baseUrl+"/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refreshToken})})).then(function(r){function t(t){return Promise.resolve(r.json()).then(function(r){e.token=r.access_token,e.refreshToken=r.refresh_token,e.tokenExpiry=Date.now()+1e3*r.expires_in-3e5})}var n=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Token refresh failed")})}();return n&&n.then?n.then(t):t()})},function(e){throw console.error("VisionFly token refresh error:",e),e}))}catch(e){return Promise.reject(e)}},r._request=function(e,r){void 0===r&&(r={});try{var t=this;return Promise.resolve(t._ensureAuthenticated()).then(function(){var n={headers:{Authorization:"Bearer "+t.token}},o=u({},n,r,{headers:u({},n.headers,r.headers)});return c(function(){return Promise.resolve(fetch(""+t.baseUrl+e,o)).then(function(r){function n(){function e(e){return r.json()}var t=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Request failed with status "+r.status)})}();return t&&t.then?t.then(e):e()}var i=function(){if(401===r.status)return Promise.resolve(t._refreshToken()).then(function(){return o.headers.Authorization="Bearer "+t.token,Promise.resolve(fetch(""+t.baseUrl+e,o)).then(function(e){r=e})})}();return i&&i.then?i.then(n):n()})},function(e){throw console.error("VisionFly request error:",e),e})})}catch(e){return Promise.reject(e)}},r.getImageUrl=function(e){try{var r=this,t=JSON.stringify(e);if(r.urlCache.has(t))return Promise.resolve(r.urlCache.get(t));var n=new URLSearchParams,o={src:"src",width:"w",height:"h",quality:"q",format:"f",blur:"blur",sharpen:"sharp",brightness:"bri",contrast:"con",saturation:"sat",hue:"hue"};Object.entries(e).forEach(function(e){var r=e[0],t=e[1];null!=t&&n.append(o[r]||r,t)});var i="/transform?"+n.toString();return Promise.resolve(r._request(i)).then(function(e){if(!e.public_url)throw new Error("Transform API did not return a public_url");return r.urlCache.set(t,e.public_url),e.public_url})}catch(e){return Promise.reject(e)}},r.getSrcSet=function(e){try{var r=this,t=e.src,n=e.widths,o=void 0===n?[400,800,1200]:n,i=e.format,a=void 0===i?"auto":i,u=e.quality,l=void 0===u?80:u,c=Array.isArray(o)?o.join(","):o,h=new URLSearchParams({src:t,w:c,f:a,q:l});return Promise.resolve(r._request("/generate/srcset?"+h.toString())).then(function(e){var t=e.srcset.split(",").map(function(e){return e.trim()});return Promise.resolve(Promise.all(t.map(function(e){try{for(var t,n=e.split(" "),o=n[1],i=new URL(n[0]),a={},u={src:"src",w:"width",h:"height",q:"quality",f:"format",blur:"blur",sharp:"sharpen",bri:"brightness",con:"contrast",sat:"saturation",hue:"hue"},l=s(i.searchParams.entries());!(t=l()).done;){var c=t.value,h=c[0];a[u[h]||h]=c[1]}return Promise.resolve(r.getImageUrl(a)).then(function(e){return e+" "+o})}catch(e){return Promise.reject(e)}}))).then(function(t){for(var n,o={},i={src:"src",w:"width",h:"height",q:"quality",f:"format",blur:"blur",sharp:"sharpen",bri:"brightness",con:"contrast",sat:"saturation",hue:"hue"},a=s(new URL(e.default).searchParams.entries());!(n=a()).done;){var u=n.value,l=u[0];o[i[l]||l]=u[1]}return Promise.resolve(r.getImageUrl(o)).then(function(r){return{srcset:t.join(", "),sizes:e.sizes,default:r}})})})}catch(e){return Promise.reject(e)}},r.uploadImage=function(e){try{var r=e.file,t=e.projectId,n=e.publicId,o=new FormData;return o.append("file",r),o.append("project_id",t),n&&o.append("public_id",n),Promise.resolve(this._request("/upload/",{method:"POST",body:o,headers:{}}))}catch(e){return Promise.reject(e)}},r.clearCache=function(){this.urlCache.clear()},e}(),d=["src","width","height","quality","format","blur","sharpen","brightness","contrast","saturation","hue","alt","className","style","loading"],v=["src","widths","sizes","quality","format","alt","className","style","loading"],m=["projectId","onUpload","onError","publicId","multiple","className","style","buttonClassName","buttonStyle","buttonText","children"];function p(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var y=e(null);function g(e){var n=e.config,o=e.children,i=r(function(){return new f(n)})[0],a=r(!1),s=a[0],u=a[1];return t(function(){!function(){try{var e=p(function(){return Promise.resolve(i._ensureAuthenticated()).then(function(){u(!0)})},function(e){console.error("Failed to initialize VisionFly client:",e)});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[i]),h(y.Provider,{value:{client:i,ready:s}},o)}function b(){var e=n(y);if(!e)throw new Error("useVisionFly must be used within a VisionFlyProvider");return e}function P(e){var n=e.src,o=e.width,i=e.height,a=e.quality,s=e.format,c=e.blur,f=e.sharpen,v=e.brightness,m=e.contrast,y=e.saturation,g=e.hue,P=e.alt,w=void 0===P?"":P,j=e.className,k=void 0===j?"":j,I=e.style,S=void 0===I?{}:I,_=e.loading,U=void 0===_?"lazy":_,q=l(e,d),x=b(),N=x.client,C=x.ready,A=r(""),E=A[0],F=A[1],T=r(!0),O=T[0],z=T[1],V=r(null),R=V[0],D=V[1];return t(function(){if(C&&n){var e=!0;return z(!0),function(){try{var r=p(function(){return Promise.resolve(N.getImageUrl({src:n,width:o,height:i,quality:a,format:s,blur:c,sharpen:f,brightness:v,contrast:m,saturation:y,hue:g})).then(function(r){e&&(F(r),z(!1))})},function(r){e&&(console.error("Failed to load image:",r),D(r),z(!1))});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!1}}},[N,C,n,o,i,a,s,c,f,v,m,y,g]),O?h("div",u({className:"vf-image-placeholder "+k,style:u({width:o?o+"px":"100%",height:i?i+"px":"auto",backgroundColor:"#f0f0f0"},S)},q)):R?h("div",u({className:"vf-image-error "+k,style:u({width:o?o+"px":"100%",height:i?i+"px":"auto",backgroundColor:"#ff5555",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},S)},q),"Error loading image"):h("img",u({src:E,alt:w,width:o,height:i,loading:U,className:"vf-image "+k,style:S},q))}function w(e){var n=e.src,o=e.widths,i=e.sizes,a=e.quality,s=e.format,c=e.alt,f=void 0===c?"":c,d=e.className,m=void 0===d?"":d,y=e.style,g=void 0===y?{}:y,P=e.loading,w=void 0===P?"lazy":P,j=l(e,v),k=b(),I=k.client,S=k.ready,_=r(null),U=_[0],q=_[1],x=r(!0),N=x[0],C=x[1],A=r(null),E=A[0],F=A[1];return t(function(){if(S&&n){var e=!0;return C(!0),function(){try{var r=p(function(){return Promise.resolve(I.getSrcSet({src:n,widths:o,format:s,quality:a})).then(function(r){e&&(q(r),C(!1))})},function(r){e&&(console.error("Failed to load srcset:",r),F(r),C(!1))});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!1}}},[I,S,n,o&&JSON.stringify(o),i,a,s]),N?h("div",u({className:"vf-image-placeholder "+m,style:u({width:"100%",height:"300px",backgroundColor:"#f0f0f0"},g)},j)):E?h("div",u({className:"vf-image-error "+m,style:u({width:"100%",height:"300px",backgroundColor:"#ff5555",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},g)},j),"Error loading image"):h("img",u({src:U.default,srcSet:U.srcset,sizes:i||U.sizes,alt:f,loading:w,className:"vf-responsive-image "+m,style:g},j))}function j(e){var t=e.projectId,n=e.onUpload,a=e.onError,s=e.publicId,c=e.multiple,f=void 0!==c&&c,d=e.className,v=void 0===d?"":d,y=e.style,g=void 0===y?{}:y,P=e.buttonClassName,w=void 0===P?"":P,j=e.buttonStyle,k=void 0===j?{}:j,I=e.buttonText,S=void 0===I?"Upload Image":I,_=e.children,U=l(e,m),q=b(),x=q.client,N=q.ready,C=r(!1),A=C[0],E=C[1],F=o(null),T=i(function(e){try{var r=e.target.files;if(!r||0===r.length)return Promise.resolve();E(!0);var o=p(function(){function e(){F.current&&(F.current.value="")}var o=f?Promise.resolve(Promise.all(Array.from(r).map(function(e){return x.uploadImage({file:e,projectId:t,publicId:s||void 0})}))).then(function(e){E(!1),n&&n(e)}):Promise.resolve(x.uploadImage({file:r[0],projectId:t,publicId:s||void 0})).then(function(e){E(!1),n&&n(e)});return o&&o.then?o.then(e):e()},function(e){E(!1),console.error("Upload failed:",e),a&&a(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[x,t,s,f,n,a]),O=_||h("button",{type:"button",className:"vf-upload-button "+w,style:k,disabled:A||!N},A?"Uploading...":S);return h("div",u({className:"vf-uploader "+v,style:g},U),h("input",{ref:F,type:"file",accept:"image/*",multiple:f,onChange:T,style:{display:"none"},id:"vf-file-input"}),h("label",{htmlFor:"vf-file-input"},O))}var k={VisionFlyProvider:g,useVisionFly:b,VFImage:P,VFResponsiveImage:w,VFUploader:j};export{P as VFImage,w as VFResponsiveImage,j as VFUploader,g as VisionFlyProvider,k as default,b as useVisionFly};
//# sourceMappingURL=react.modern.js.map
