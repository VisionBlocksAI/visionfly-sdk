!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e||self).visionflySdk={},e.react)}(this,function(e,r){function t(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=Array(r);t<r;t++)n[t]=e[t];return n}function n(e,r){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o.apply(null,arguments)}function i(e,r){if(null==e)return{};var t={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==r.indexOf(n))continue;t[n]=e[n]}return t}function a(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var s=/*#__PURE__*/function(){function e(e){var r=e.apiSecret,t=e.baseUrl,n=void 0===t?"https://api.visionfly.ai":t,o=e.cdnUrl,i=void 0===o?"https://cdn.visionfly.ai":o;this.apiKey=e.apiKey,this.apiSecret=r,this.baseUrl=n,this.cdnUrl=i,this.token=null,this.tokenExpiry=null,this.refreshToken=null,this.urlCache=new Map}var r=e.prototype;return r._ensureAuthenticated=function(){try{var e=this;return e.token&&e.tokenExpiry&&e.tokenExpiry>Date.now()?Promise.resolve():Promise.resolve(e._authenticate()).then(function(){})}catch(e){return Promise.reject(e)}},r._authenticate=function(){try{var e=this;return Promise.resolve(a(function(){return Promise.resolve(fetch(e.baseUrl+"/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:e.apiKey,api_secret:e.apiSecret})})).then(function(r){function t(t){return Promise.resolve(r.json()).then(function(r){e.token=r.access_token,e.refreshToken=r.refresh_token,e.tokenExpiry=Date.now()+1e3*r.expires_in-3e5})}var n=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Authentication failed")})}();return n&&n.then?n.then(t):t()})},function(e){throw console.error("VisionFly authentication error:",e),e}))}catch(e){return Promise.reject(e)}},r._refreshToken=function(){try{var e=this;return Promise.resolve(a(function(){return Promise.resolve(fetch(e.baseUrl+"/auth/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e.refreshToken})})).then(function(r){function t(t){return Promise.resolve(r.json()).then(function(r){e.token=r.access_token,e.refreshToken=r.refresh_token,e.tokenExpiry=Date.now()+1e3*r.expires_in-3e5})}var n=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Token refresh failed")})}();return n&&n.then?n.then(t):t()})},function(e){throw console.error("VisionFly token refresh error:",e),e}))}catch(e){return Promise.reject(e)}},r._request=function(e,r){void 0===r&&(r={});try{var t=this;return Promise.resolve(t._ensureAuthenticated()).then(function(){var n={headers:{Authorization:"Bearer "+t.token}},i=o({},n,r,{headers:o({},n.headers,r.headers)});return a(function(){return Promise.resolve(fetch(""+t.baseUrl+e,i)).then(function(r){function n(){function e(e){return r.json()}var t=function(){if(!r.ok)return Promise.resolve(r.json()).then(function(e){throw new Error(e.msg||"Request failed with status "+r.status)})}();return t&&t.then?t.then(e):e()}var o=function(){if(401===r.status)return Promise.resolve(t._refreshToken()).then(function(){return i.headers.Authorization="Bearer "+t.token,Promise.resolve(fetch(""+t.baseUrl+e,i)).then(function(e){r=e})})}();return o&&o.then?o.then(n):n()})},function(e){throw console.error("VisionFly request error:",e),e})})}catch(e){return Promise.reject(e)}},r.getImageUrl=function(e){try{var r=this,t=JSON.stringify(e);if(r.urlCache.has(t))return Promise.resolve(r.urlCache.get(t));var n=new URLSearchParams,o={src:"src",width:"w",height:"h",quality:"q",format:"f",blur:"blur",sharpen:"sharp",brightness:"bri",contrast:"con",saturation:"sat",hue:"hue"};Object.entries(e).forEach(function(e){var r=e[0],t=e[1];null!=t&&n.append(o[r]||r,t)});var i="/transform?"+n.toString();return Promise.resolve(r._request(i)).then(function(e){if(!e.public_url)throw new Error("Transform API did not return a public_url");return r.urlCache.set(t,e.public_url),e.public_url})}catch(e){return Promise.reject(e)}},r.getSrcSet=function(e){try{var r=this,t=e.src,o=e.widths,i=void 0===o?[400,800,1200]:o,a=e.format,s=void 0===a?"auto":a,u=e.quality,l=void 0===u?80:u,c=Array.isArray(i)?i.join(","):i,h=new URLSearchParams({src:t,w:c,f:s,q:l});return Promise.resolve(r._request("/generate/srcset?"+h.toString())).then(function(e){var t=e.srcset.split(",").map(function(e){return e.trim()});return Promise.resolve(Promise.all(t.map(function(e){try{for(var t,o=e.split(" "),i=o[1],a=new URL(o[0]),s={},u={src:"src",w:"width",h:"height",q:"quality",f:"format",blur:"blur",sharp:"sharpen",bri:"brightness",con:"contrast",sat:"saturation",hue:"hue"},l=n(a.searchParams.entries());!(t=l()).done;){var c=t.value,h=c[0];s[u[h]||h]=c[1]}return Promise.resolve(r.getImageUrl(s)).then(function(e){return e+" "+i})}catch(e){return Promise.reject(e)}}))).then(function(t){for(var o,i={},a={src:"src",w:"width",h:"height",q:"quality",f:"format",blur:"blur",sharp:"sharpen",bri:"brightness",con:"contrast",sat:"saturation",hue:"hue"},s=n(new URL(e.default).searchParams.entries());!(o=s()).done;){var u=o.value,l=u[0];i[a[l]||l]=u[1]}return Promise.resolve(r.getImageUrl(i)).then(function(r){return{srcset:t.join(", "),sizes:e.sizes,default:r}})})})}catch(e){return Promise.reject(e)}},r.uploadImage=function(e){try{var r=e.file,t=e.projectId,n=e.publicId,o=new FormData;return o.append("file",r),o.append("project_id",t),n&&o.append("public_id",n),Promise.resolve(this._request("/upload/",{method:"POST",body:o,headers:{}}))}catch(e){return Promise.reject(e)}},r.clearCache=function(){this.urlCache.clear()},e}(),u=["src","width","height","quality","format","blur","sharpen","brightness","contrast","saturation","hue","alt","className","style","loading"],l=["src","widths","sizes","quality","format","alt","className","style","loading"],c=["projectId","onUpload","onError","publicId","multiple","className","style","buttonClassName","buttonStyle","buttonText","children"];function f(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}var d=r.createContext(null);function v(e){var t=e.config,n=e.children,o=r.useState(function(){return new s(t)})[0],i=r.useState(!1),a=i[0],u=i[1];return r.useEffect(function(){!function(){try{var e=f(function(){return Promise.resolve(o._ensureAuthenticated()).then(function(){u(!0)})},function(e){console.error("Failed to initialize VisionFly client:",e)});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()},[o]),h(d.Provider,{value:{client:o,ready:a}},n)}function m(){var e=r.useContext(d);if(!e)throw new Error("useVisionFly must be used within a VisionFlyProvider");return e}function p(e){var t=e.src,n=e.width,a=e.height,s=e.quality,l=e.format,c=e.blur,d=e.sharpen,v=e.brightness,p=e.contrast,y=e.saturation,g=e.hue,b=e.alt,P=void 0===b?"":b,w=e.className,j=void 0===w?"":w,S=e.style,k=void 0===S?{}:S,I=e.loading,_=void 0===I?"lazy":I,x=i(e,u),U=m(),q=U.client,C=U.ready,F=r.useState(""),N=F[0],E=F[1],T=r.useState(!0),A=T[0],V=T[1],O=r.useState(null),z=O[0],R=O[1];return r.useEffect(function(){if(C&&t){var e=!0;return V(!0),function(){try{var r=f(function(){return Promise.resolve(q.getImageUrl({src:t,width:n,height:a,quality:s,format:l,blur:c,sharpen:d,brightness:v,contrast:p,saturation:y,hue:g})).then(function(r){e&&(E(r),V(!1))})},function(r){e&&(console.error("Failed to load image:",r),R(r),V(!1))});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!1}}},[q,C,t,n,a,s,l,c,d,v,p,y,g]),A?h("div",o({className:"vf-image-placeholder "+j,style:o({width:n?n+"px":"100%",height:a?a+"px":"auto",backgroundColor:"#f0f0f0"},k)},x)):z?h("div",o({className:"vf-image-error "+j,style:o({width:n?n+"px":"100%",height:a?a+"px":"auto",backgroundColor:"#ff5555",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},k)},x),"Error loading image"):h("img",o({src:N,alt:P,width:n,height:a,loading:_,className:"vf-image "+j,style:k},x))}function y(e){var t=e.src,n=e.widths,a=e.sizes,s=e.quality,u=e.format,c=e.alt,d=void 0===c?"":c,v=e.className,p=void 0===v?"":v,y=e.style,g=void 0===y?{}:y,b=e.loading,P=void 0===b?"lazy":b,w=i(e,l),j=m(),S=j.client,k=j.ready,I=r.useState(null),_=I[0],x=I[1],U=r.useState(!0),q=U[0],C=U[1],F=r.useState(null),N=F[0],E=F[1];return r.useEffect(function(){if(k&&t){var e=!0;return C(!0),function(){try{var r=f(function(){return Promise.resolve(S.getSrcSet({src:t,widths:n,format:u,quality:s})).then(function(r){e&&(x(r),C(!1))})},function(r){e&&(console.error("Failed to load srcset:",r),E(r),C(!1))});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){e=!1}}},[S,k,t,n&&JSON.stringify(n),a,s,u]),q?h("div",o({className:"vf-image-placeholder "+p,style:o({width:"100%",height:"300px",backgroundColor:"#f0f0f0"},g)},w)):N?h("div",o({className:"vf-image-error "+p,style:o({width:"100%",height:"300px",backgroundColor:"#ff5555",display:"flex",alignItems:"center",justifyContent:"center",color:"white"},g)},w),"Error loading image"):h("img",o({src:_.default,srcSet:_.srcset,sizes:a||_.sizes,alt:d,loading:P,className:"vf-responsive-image "+p,style:g},w))}function g(e){var t=e.projectId,n=e.onUpload,a=e.onError,s=e.publicId,u=e.multiple,l=void 0!==u&&u,d=e.className,v=void 0===d?"":d,p=e.style,y=void 0===p?{}:p,g=e.buttonClassName,b=void 0===g?"":g,P=e.buttonStyle,w=void 0===P?{}:P,j=e.buttonText,S=void 0===j?"Upload Image":j,k=e.children,I=i(e,c),_=m(),x=_.client,U=_.ready,q=r.useState(!1),C=q[0],F=q[1],N=r.useRef(null),E=r.useCallback(function(e){try{var r=e.target.files;if(!r||0===r.length)return Promise.resolve();F(!0);var o=f(function(){function e(){N.current&&(N.current.value="")}var o=l?Promise.resolve(Promise.all(Array.from(r).map(function(e){return x.uploadImage({file:e,projectId:t,publicId:s||void 0})}))).then(function(e){F(!1),n&&n(e)}):Promise.resolve(x.uploadImage({file:r[0],projectId:t,publicId:s||void 0})).then(function(e){F(!1),n&&n(e)});return o&&o.then?o.then(e):e()},function(e){F(!1),console.error("Upload failed:",e),a&&a(e)});return Promise.resolve(o&&o.then?o.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},[x,t,s,l,n,a]),T=k||h("button",{type:"button",className:"vf-upload-button "+b,style:w,disabled:C||!U},C?"Uploading...":S);return h("div",o({className:"vf-uploader "+v,style:y},I),h("input",{ref:N,type:"file",accept:"image/*",multiple:l,onChange:E,style:{display:"none"},id:"vf-file-input"}),h("label",{htmlFor:"vf-file-input"},T))}var b={VisionFlyProvider:v,useVisionFly:m,VFImage:p,VFResponsiveImage:y,VFUploader:g};e.VFImage=p,e.VFResponsiveImage=y,e.VFUploader=g,e.VisionFlyProvider=v,e.default=b,e.useVisionFly=m});
//# sourceMappingURL=react.umd.js.map
